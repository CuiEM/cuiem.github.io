<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>矩阵鞍点迭代求解器</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1a2a6c, #2a4d69, #4b86b4);
            color: #333;
            min-height: 100vh;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(90deg, #1a2a6c, #2a4d69);
            color: white;
            padding: 15px 20px;
            text-align: center;
        }
        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        .content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            padding: 20px;
        }
        .panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 15px;
            transition: transform 0.3s ease;
        }
        .panel:hover {
            transform: translateY(-5px);
        }
        h2 {
            color: #1a2a6c;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #4b86b4;
            font-size: 1.4rem;
        }
        .matrix-input {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 15px;
        }
        .matrix-row {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        .matrix-cell {
            width: 70px;
            height: 55px;
            border: 2px solid #2a4d69;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            font-weight: bold;
            background: #f0f8ff;
        }
        .matrix-cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 1rem;
            background: transparent;
        }
        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 15px 0;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            width: 100%;
        }
        label {
            font-weight: bold;
            color: #2a4d69;
            font-size: 0.9rem;
        }
        select, input {
            padding: 12px;
            border: 2px solid #4b86b4;
            border-radius: 5px;
            font-size: 1rem;
            width: 100%;
        }
        button {
            background: linear-gradient(90deg, #1a2a6c, #2a4d69);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 100%;
            margin-top: 5px;
        }
        button:hover {
            background: linear-gradient(90deg, #2a4d69, #1a2a6c);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #iteration-controls {
            display: block !important; /* 始终显示迭代控制区 */
            margin-top: 15px;
            background: #e6f2ff;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #2a4d69;
        }
        .iteration-info {
            margin: 12px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            font-size: 0.9rem;
        }
        .iteration-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            font-size: 0.85rem;
        }
        .iteration-table th {
            background: #2a4d69;
            color: white;
            padding: 10px;
            text-align: center;
        }
        .iteration-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }
        .iteration-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .iteration-table tr:hover {
            background-color: #e3f2fd;
        }
        .highlight {
            background-color: #ffeaa7 !important;
            font-weight: bold;
        }
        .saddle-point {
            background-color: #2ecc71 !important;
            color: white;
            font-weight: bold;
        }
        .end-iteration-row {
            background-color: #ffb8b8 !important;
            font-weight: bold;
        }
        .saddle-notice-row {
            background-color: #fff3cd !important;
            color: #856404;
        }
        .result-message {
            padding: 12px;
            margin: 12px 0;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            font-size: 0.9rem;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .matrix-display {
            margin-top: 15px;
            overflow-x: auto;
            padding: 10px 0;
        }
        .matrix-display table {
            border-collapse: collapse;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .matrix-display td {
            width: 65px;
            height: 50px;
            text-align: center;
            border: 2px solid #2a4d69;
            padding: 6px;
            position: relative;
            background: #f0f8ff;
            font-weight: bold;
            font-size: 1rem;
        }
        .matrix-display .highlight-col {
            background-color: #a8dadc;
        }
        .matrix-display .highlight-row {
            background-color: #ff9a8b;
        }
        .matrix-display .current-cell {
            background-color: #ffeaa7;
            font-weight: bold;
        }
        .matrix-display .saddle-cell {
            background-color: #2ecc71;
            color: white;
            font-weight: bold;
            /* 保留鞍点永久高亮 */
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.4); }
            70% { box-shadow: 0 0 0 5px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        .matrix-display .end-cell {
            background-color: #e74c3c;
            color: white;
            font-weight: bold;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 12px 0;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #999;
        }
        .controls-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .result-summary {
            margin-top: 15px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #2a4d69;
            overflow-x: auto;
            max-height: 300px; /* 限制高度，确保滚动可见 */
            overflow-y: auto;
        }
        .result-summary h3 {
            margin-bottom: 8px;
            color: #1a2a6c;
            font-size: 1.1rem;
        }
        .result-summary p {
            margin: 6px 0;
            font-size: 0.9rem;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
        }
        .status-active {
            background-color: #2ecc71;
        }
        .status-inactive {
            background-color: #e74c3c;
        }
        .instructions {
            background-color: #f8f9fa;
            border-left: 4px solid #4b86b4;
            padding: 12px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .instructions h3 {
            color: #1a2a6c;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        .instructions ul {
            padding-left: 18px;
        }
        .instructions li {
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        /* 针对大屏幕的优化 */
        @media (min-width: 768px) {
            body {
                padding: 20px;
                align-items: center;
            }
            .content {
                grid-template-columns: 1fr 1fr;
                gap: 25px;
                padding: 25px;
            }
            .controls {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .control-group {
                flex: 1;
            }
            button {
                width: auto;
            }
            .controls-row {
                flex-direction: row;
            }
            .matrix-cell {
                width: 80px;
                height: 60px;
            }
            .matrix-display td {
                width: 80px;
                height: 60px;
            }
        }
        /* 针对小屏幕的进一步优化 */
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }
            .subtitle {
                font-size: 0.9rem;
            }
            .matrix-cell {
                width: 60px;
                height: 50px;
            }
            .matrix-display {
                padding: 10px;
                margin: 0 -10px;
            }
            .matrix-display td {
                width: 55px;
                height: 45px;
                font-size: 0.9rem;
                padding: 3px;
            }
            .legend {
                gap: 8px;
                padding: 0 5px;
            }
            .legend-item {
                font-size: 0.7rem;
                gap: 4px;
            }
            .legend-color {
                width: 16px;
                height: 16px;
            }
            .iteration-table {
                font-size: 0.75rem;
            }
            .iteration-table th,
            .iteration-table td {
                padding: 6px 4px;
            }
            .iteration-info {
                font-size: 0.85rem;
                padding: 10px;
            }
            .result-summary {
                padding: 10px;
                margin-left: -10px;
                margin-right: -10px;
                border-radius: 0;
            }
            .panel {
                padding: 12px 10px;
            }
            h2 {
                font-size: 1.2rem;
                margin-bottom: 10px;
            }
            select, input, button {
                padding: 10px;
                font-size: 0.9rem;
            }
            .content {
                padding: 15px 10px;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>矩阵鞍点迭代求解器</h1>
            <div class="subtitle">交互式鞍点查找算法 - 行模式与列模式（支持持续迭代）</div>
        </header>
        
        <div class="content">
            <div class="panel">
                <h2>矩阵输入与设置</h2>
                <div class="matrix-input">
                    <div class="matrix-row">
                        <div class="matrix-cell"><input type="number" id="cell-0-0" value="30"></div>
                        <div class="matrix-cell"><input type="number" id="cell-0-1" value="-40"></div>
                        <div class="matrix-cell"><input type="number" id="cell-0-2" value="85"></div>
                    </div>
                    <div class="matrix-row">
                        <div class="matrix-cell"><input type="number" id="cell-1-0" value="65"></div>
                        <div class="matrix-cell"><input type="number" id="cell-1-1" value="20"></div>
                        <div class="matrix-cell"><input type="number" id="cell-1-2" value="90"></div>
                    </div>
                    <div class="matrix-row">
                        <div class="matrix-cell"><input type="number" id="cell-2-0" value="15"></div>
                        <div class="matrix-cell"><input type="number" id="cell-2-1" value="-10"></div>
                        <div class="matrix-cell"><input type="number" id="cell-2-2" value="75"></div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label for="startType">起始选择:</label>
                        <select id="startType">
                            <option value="row">选择行开始</option>
                            <option value="column">选择列开始</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="startIndex">起始索引 (1-3):</label>
                        <input type="number" id="startIndex" min="1" max="3" placeholder="输入1-3的索引">
                    </div>
                    
                    <div class="control-group">
                        <label>&nbsp;</label>
                        <button id="startBtn">开始迭代</button>
                    </div>
                </div>
                
                <div id="iteration-controls">
                    <h3>迭代控制</h3>
                    <div class="iteration-info" id="current-state">
                        当前状态将显示在这里...
                    </div>
                    
                    <div class="controls-row">
                        <div class="control-group">
                            <label for="nextIndex">下一步索引 (1-3):</label>
                            <input type="number" id="nextIndex" min="1" max="3" placeholder="输入1-3的索引">
                        </div>
                        
                        <div class="control-group">
                            <label>&nbsp;</label>
                            <button id="nextStepBtn">下一步</button>
                        </div>
                        
                        <div class="control-group">
                            <label>&nbsp;</label>
                            <button id="endBtn">结束迭代</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2>迭代过程与结果</h2>
                <div class="matrix-display" id="matrix-display">
                    <!-- 矩阵显示区域将由JS生成 -->
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ffeaa7;"></div>
                        <div>当前选择</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #a8dadc;"></div>
                        <div>行模式高亮列</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ff9a8b;"></div>
                        <div>列模式高亮行</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #2ecc71;"></div>
                        <div>鞍点（永久高亮）</div>
                    </div>
                </div>
                
                <div class="result-summary">
                    <h3>迭代步骤记录</h3>
                    <table class="iteration-table">
                        <thead>
                            <tr>
                                <<th>步骤</</th>
                                <<th>选择行</</th>
                                <<th>选择列</</th>
                                <<th>元素值</</th>
                                <<th>备注</</th>
                            </tr>
                        </thead>
                        <tbody id="history-body">
                            <!-- 迭代历史将由JS生成 -->
                        </tbody>
                    </table>
                </div>
                
                <div class="result-message" id="result-message">
                    <!-- 结果消息将显示在这里 -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 矩阵数据结构
            const matrix = [
                [30, -40, 85],
                [65, 20, 90],
                [15, -10, 75]
            ];
            
            // DOM元素
            const startBtn = document.getElementById('startBtn');
            const nextStepBtn = document.getElementById('nextStepBtn');
            const endBtn = document.getElementById('endBtn');
            const startTypeSelect = document.getElementById('startType');
            const startIndexInput = document.getElementById('startIndex');
            const nextIndexInput = document.getElementById('nextIndex');
            const currentStateDiv = document.getElementById('current-state');
            const resultMessageDiv = document.getElementById('result-message');
            const historyBody = document.getElementById('history-body');
            const matrixDisplay = document.getElementById('matrix-display');
            
            // 状态变量
            let currentMode = 'row'; // 'row' 或 'column'
            let currentStep = 0;
            let currentRow = -1;
            let currentCol = -1;
            let iterationHistory = [];
            let isIterationActive = false;
            let saddlePointsFound = []; // 存储所有找到的鞍点（支持多个）
            let lastSaddleNoticeStep = -1; // 记录上一次鞍点提示的步骤
            
            // 初始化矩阵显示
            function initializeMatrixDisplay() {
                matrixDisplay.innerHTML = '';
                const table = document.createElement('table');
                
                for (let i = 0; i < 3; i++) {
                    const tr = document.createElement('tr');
                    for (let j = 0; j < 3; j++) {
                        const td = document.createElement('td');
                        td.textContent = matrix[i][j];
                        td.id = `display-cell-${i}-${j}`;
                        tr.appendChild(td);
                    }
                    table.appendChild(tr);
                }
                
                matrixDisplay.appendChild(table);
            }
            
            // 更新矩阵显示（保留所有鞍点高亮）
            function updateMatrixDisplay() {
                // 清除所有非永久高亮
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        const cell = document.getElementById(`display-cell-${i}-${j}`);
                        // 保留鞍点高亮，清除其他类
                        if (cell.classList.contains('saddle-cell')) {
                            cell.className = 'saddle-cell';
                        } else {
                            cell.className = '';
                        }
                    }
                }
                
                // 高亮当前选择
                if (currentRow !== -1 && currentCol !== -1) {
                    const currentCell = document.getElementById(`display-cell-${currentRow}-${currentCol}`);
                    if (currentCell) {
                        // 如果当前选择是鞍点，叠加当前选择样式
                        if (currentCell.classList.contains('saddle-cell')) {
                            currentCell.classList.add('current-cell');
                        } else {
                            currentCell.classList.add('current-cell');
                        }
                    }
                }
                
                // 根据模式高亮行或列
                if (currentMode === 'row' && currentCol !== -1) {
                    for (let i = 0; i < 3; i++) {
                        const cell = document.getElementById(`display-cell-${i}-${currentCol}`);
                        if (cell && !cell.classList.contains('saddle-cell')) {
                            cell.classList.add('highlight-col');
                        }
                    }
                } else if (currentMode === 'column' && currentRow !== -1) {
                    for (let j = 0; j < 3; j++) {
                        const cell = document.getElementById(`display-cell-${currentRow}-${j}`);
                        if (cell && !cell.classList.contains('saddle-cell')) {
                            cell.classList.add('highlight-row');
                        }
                    }
                }
                
                // 高亮所有找到的鞍点
                saddlePointsFound.forEach(saddle => {
                    const saddleCell = document.getElementById(`display-cell-${saddle.row}-${saddle.col}`);
                    if (saddleCell) {
                        saddleCell.classList.add('saddle-cell');
                    }
                });
                
                // 在小屏幕上自动滚动到矩阵区域
                if (window.innerWidth <= 480 && isIterationActive) {
                    matrixDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            
            // 更新迭代历史（支持鞍点备注）
            function updateHistory() {
                historyBody.innerHTML = '';
                
                iterationHistory.forEach(step => {
                    const tr = document.createElement('tr');
                    
                    // 结束迭代行
                    if (step.type === 'end') {
                        tr.innerHTML = `
                            <td>${step.step}</td>
                            <td colspan="4" class="end-iteration-row">${step.message}</td>
                        `;
                    }
                    // 鞍点提示行
                    else if (step.type === 'saddle-notice') {
                        tr.innerHTML = `
                            <td>${step.step}</td>
                            <td colspan="4" class="saddle-notice-row">${step.message}</td>
                        `;
                    }
                    // 普通迭代步骤
                    else {
                        tr.innerHTML = `
                            <td>${step.step}</td>
                            <td>${step.selectedRow}</td>
                            <td>${step.selectedCol}</td>
                            <td>${step.element}</td>
                            <td>${step.note || '-'}</td>
                        `;
                    }
                    
                    historyBody.appendChild(tr);
                });
                
                // 强制DOM重绘
                historyBody.offsetHeight;
                // 自动滚动到表格底部
                const historyContainer = document.querySelector('.result-summary');
                historyContainer.scrollTop = historyContainer.scrollHeight;
            }
            
            // 检查当前元素是否是鞍点（不终止迭代）
            function checkForSaddlePoint() {
                const row = currentRow;
                const col = currentCol;
                const value = matrix[row][col];
                
                // 检查是否已存在该鞍点
                const isDuplicate = saddlePointsFound.some(s => s.row === row && s.col === col);
                if (isDuplicate) return false;
                
                // 检查是否行最小值
                let isRowMin = true;
                for (let j = 0; j < 3; j++) {
                    if (matrix[row][j] < value) {
                        isRowMin = false;
                        break;
                    }
                }
                
                // 检查是否列最大值
                let isColMax = true;
                for (let i = 0; i < 3; i++) {
                    if (matrix[i][col] > value) {
                        isColMax = false;
                        break;
                    }
                }
                
                // 如果是鞍点，添加到列表并提示
                if (isRowMin && isColMax) {
                    const newSaddle = { row, col, value };
                    saddlePointsFound.push(newSaddle);
                    
                    // 显示鞍点提示（仅在结果区显示，不阻断迭代）
                    resultMessageDiv.className = 'result-message success';
                    resultMessageDiv.innerHTML = `
                        找到鞍点! 位于行${row + 1}, 列${col + 1}, 值为${value}
                        <br>可继续迭代或点击"结束迭代"
                    `;
                    
                    // 在历史记录中添加鞍点提示（避免重复提示）
                    if (currentStep !== lastSaddleNoticeStep) {
                        iterationHistory.push({
                            step: currentStep,
                            type: 'saddle-notice',
                            message: `提示：已找到鞍点（行${row + 1}, 列${col + 1}, 值${value}），支持继续迭代`
                        });
                        lastSaddleNoticeStep = currentStep;
                    }
                    
                    return true;
                }
                
                return false;
            }
            
            // 开始迭代
            function startIteration() {
                // 重置状态（保留鞍点记录清空）
                currentStep = 1;
                iterationHistory = [];
                saddlePointsFound = [];
                lastSaddleNoticeStep = -1;
                currentRow = -1;
                currentCol = -1;
                isIterationActive = true;
                resultMessageDiv.className = '';
                resultMessageDiv.innerHTML = '';
                
                // 验证起始索引
                const startIndexStr = startIndexInput.value.trim();
                if (!startIndexStr) {
                    resultMessageDiv.className = 'result-message error';
                    resultMessageDiv.textContent = '请输入起始索引（1-3）';
                    setTimeout(() => {
                        resultMessageDiv.className = '';
                        resultMessageDiv.textContent = '';
                    }, 5000);
                    return;
                }
                
                currentMode = startTypeSelect.value;
                const startIndex = parseInt(startIndexStr) - 1;
                
                if (isNaN(startIndex) || startIndex < 0 || startIndex > 2) {
                    resultMessageDiv.className = 'result-message error';
                    resultMessageDiv.textContent = '请输入有效的起始索引（1-3）';
                    setTimeout(() => {
                        resultMessageDiv.className = '';
                        resultMessageDiv.textContent = '';
                    }, 5000);
                    return;
                }
                
                // 执行第一步
                if (currentMode === 'row') {
                    performRowStep(startIndex);
                } else {
                    performColumnStep(startIndex);
                }
                
                // 清空起始索引输入框
                startIndexInput.value = '';
                // 小屏幕滚动
                if (window.innerWidth <= 480) {
                    document.querySelector('.content > .panel:last-child').scrollIntoView({ behavior: 'smooth' });
                }
            }
            
            // 执行行模式步骤
            function performRowStep(rowIndex) {
                currentRow = rowIndex;
                
                // 找当前行最小值列
                let minCol = 0;
                for (let j = 1; j < 3; j++) {
                    if (matrix[rowIndex][j] < matrix[rowIndex][minCol]) {
                        minCol = j;
                    }
                }
                currentCol = minCol;
                const currentValue = matrix[rowIndex][minCol];
                
                // 检查鞍点
                const isSaddle = checkForSaddlePoint();
                
                // 更新状态显示
                currentStateDiv.innerHTML = `
                    <p><span class="status-indicator status-active"></span> 行模式 - 第${currentStep}步</p>
                    <p>选择行: ${rowIndex + 1} → 最小值在列: ${minCol + 1}</p>
                    <p>当前元素: ${currentValue} (行${rowIndex + 1}, 列${minCol + 1})</p>
                    ${isSaddle ? '<p style="color:#155724;">✓ 该元素是鞍点</p>' : ''}
                `;
                
                // 记录历史
                iterationHistory.push({
                    step: currentStep,
                    selectedRow: rowIndex + 1,
                    selectedCol: minCol + 1,
                    element: currentValue,
                    note: isSaddle ? '鞍点' : '',
                    type: 'step'
                });
                
                // 更新显示
                updateMatrixDisplay();
                updateHistory();
            }
            
            // 执行列模式步骤
            function performColumnStep(colIndex) {
                currentCol = colIndex;
                
                // 找当前列最大值行
                let maxRow = 0;
                for (let i = 1; i < 3; i++) {
                    if (matrix[i][colIndex] > matrix[maxRow][colIndex]) {
                        maxRow = i;
                    }
                }
                currentRow = maxRow;
                const currentValue = matrix[maxRow][colIndex];
                
                // 检查鞍点
                const isSaddle = checkForSaddlePoint();
                
                // 更新状态显示
                currentStateDiv.innerHTML = `
                    <p><span class="status-indicator status-active"></span> 列模式 - 第${currentStep}步</p>
                    <p>选择列: ${colIndex + 1} → 最大值在行: ${maxRow + 1}</p>
                    <p>当前元素: ${currentValue} (行${maxRow + 1}, 列${colIndex + 1})</p>
                    ${isSaddle ? '<p style="color:#155724;">✓ 该元素是鞍点</p>' : ''}
                `;
                
                // 记录历史
                iterationHistory.push({
                    step: currentStep,
                    selectedRow: maxRow + 1,
                    selectedCol: colIndex + 1,
                    element: currentValue,
                    note: isSaddle ? '鞍点' : '',
                    type: 'step'
                });
                
                // 更新显示
                updateMatrixDisplay();
                updateHistory();
            }
            
            // 下一步（支持持续迭代）
            function nextStep() {
                if (!isIterationActive) return;
                
                // 验证下一步索引
                const nextIndexStr = nextIndexInput.value.trim();
                if (!nextIndexStr) {
                    resultMessageDiv.className = 'result-message error';
                    resultMessageDiv.textContent = '请输入下一步索引（1-3）';
                    setTimeout(() => {
                        resultMessageDiv.className = '';
                        resultMessageDiv.textContent = '';
                    }, 5000);
                    return;
                }
                
                const nextIndex = parseInt(nextIndexStr) - 1;
                if (isNaN(nextIndex) || nextIndex < 0 || nextIndex > 2) {
                    resultMessageDiv.className = 'result-message error';
                    resultMessageDiv.textContent = '请输入有效的下一步索引（1-3）';
                    setTimeout(() => {
                        resultMessageDiv.className = '';
                        resultMessageDiv.textContent = '';
                    }, 5000);
                    return;
                }
                
                // 模式切换处理
                const newMode = startTypeSelect.value;
                if (newMode !== currentMode) {
                    currentMode = newMode;
                    currentStep++;
                    // 记录模式切换
                    iterationHistory.push({
                        step: currentStep,
                        type: 'saddle-notice',
                        message: `模式切换：${currentMode === 'row' ? '行模式' : '列模式'}`
                    });
                    updateHistory();
                }
                
                // 步骤递增并执行
                currentStep++;
                if (currentMode === 'row') {
                    performRowStep(nextIndex);
                } else {
                    performColumnStep(nextIndex);
                }
                
                // 清空输入框
                nextIndexInput.value = '';
            }
            
            // 结束迭代（汇总鞍点信息）
            function endIteration() {
                isIterationActive = false;
                currentStep++;
                
                // 生成结束消息
                let endMessage = '';
                if (saddlePointsFound.length > 0) {
                    const saddleText = saddlePointsFound.map(s => 
                        `行${s.row + 1}, 列${s.col + 1}（值${s.value}）`
                    ).join('、');
                    endMessage = `迭代结束！共找到${saddlePointsFound.length}个鞍点：${saddleText}`;
                    
                    resultMessageDiv.className = 'result-message success';
                    resultMessageDiv.textContent = endMessage;
                } else {
                    endMessage = '迭代结束，未找到鞍点';
                    resultMessageDiv.className = 'result-message error';
                    resultMessageDiv.textContent = endMessage;
                }
                
                // 记录结束步骤
                iterationHistory.push({
                    step: currentStep,
                    type: 'end',
                    message: endMessage
                });
                
                // 更新显示
                updateHistory();
                updateMatrixDisplay();
                
                // 清空输入框
                nextIndexInput.value = '';
            }
            
            // 事件监听
            startBtn.addEventListener('click', startIteration);
            nextStepBtn.addEventListener('click', nextStep);
            endBtn.addEventListener('click', endIteration);
            
            // 输入框数值限制
            const numberInputs = document.querySelectorAll('input[type="number"]');
            numberInputs.forEach(input => {
                input.addEventListener('input', function() {
                    if (this.min && this.value < this.min) this.value = this.min;
                    if (this.max && this.value > this.max) this.value = this.max;
                });
            });
            
            // 初始化
            initializeMatrixDisplay();
            updateMatrixDisplay();
            currentStateDiv.innerHTML = '<p>请选择起始模式并输入索引，点击"开始迭代"启动流程</p>';
        });
    </script>
</body>
</html>
